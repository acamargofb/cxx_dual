<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Support for naming library variants and testing all valid possibilities</title>
<link rel="stylesheet" href="../../../../../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../../index.html" title="Chapter&#160;1.&#160;The Cxx Dual Library">
<link rel="up" href="../sec_lib.html" title="Using in a library">
<link rel="prev" href="../sec_lib.html" title="Using in a library">
<link rel="next" href="../../preprocessing_errors.html" title="Preprocessing errors">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../../boost.png"></td>
<td align="center"><a href="../../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../sec_lib.html"><img src="../../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../sec_lib.html"><img src="../../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="../../preprocessing_errors.html"><img src="../../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="cxxd.basic0.sec_lib.sec_lvvv"></a><a class="link" href="sec_lvvv.html" title="Support for naming library variants and testing all valid possibilities">Support for naming library
        variants and testing all valid possibilities</a>
</h4></div></div></div>
<p>
          CXXD offers support, based on the mods which are being included, in the
          form of macros for naming a library variant and for testing all valid possibilities.
          These macros can be used to provide a more automatic methodology for accomplishing
          the goals which can be found in the manual methods employed in the MyLibName.hpp
          sample headers specified previously. It is completely up to the end-user
          of CXXD whether he finds it easier to use the macros which I will describe
          or whether he finds it easier to use the manual methods previously explained
          and illustrated.
        </p>
<p>
          Both macros I will be discussing use the <a class="link" href="../../smods.html#cxxd.smods.hids">mod-IDs</a>
          which have been previously explained for identifying the various mods.
        </p>
<p>
          In additional a further identifier of 'CXXD_MODS_ALL' is used in each macro.
          The CXXD_MODS_ALL identifier refers to all mods in slightly different ways
          in the two macros which follow.
        </p>
<h6>
<a name="cxxd.basic0.sec_lib.sec_lvvv.h0"></a>
          <span class="phrase"><a name="cxxd.basic0.sec_lib.sec_lvvv.macro_naming_a_library_variant"></a></span><a class="link" href="sec_lvvv.html#cxxd.basic0.sec_lib.sec_lvvv.macro_naming_a_library_variant">Macro
          naming a library variant</a>
        </h6>
<p>
          There is a macro in CXXD for naming a library variant based on the dual
          library chosen for the mods being included when the macro is actually invoked.
          This macro provides an automatic methodology for naming which can replace
          a manual method the end-user may have chosen to use. The macro is a variadic
          macro whose name and signature is:
        </p>
<pre class="programlisting"><span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(...)</span>
</pre>
<p>
          The macro is in the header file &lt;boost/cxx_dual/library_name.hpp&gt;
        </p>
<p>
          The macro takes one or more variadic parameters. The single required variadic
          parameter is the base name of the library. The remaining variadic parameters
          are optional and are Boost PP tuples. Given the required base name of a
          library parameter and the optional remaining variadic parameters the macro
          expands to a library variant name.
        </p>
<p>
          Each Boost PP tuple optional oarameter has one to three elements. The first
          element, which is mandatory, is a mod-ID or the CXXD_MODS_ALL identifier.
          The second optional element, which may be empty, is a preprocessor identifier
          to be appended to the base name of the library required parameter if the
          particular mod header is being included and the C++ standard library has
          been chosen as the dual library. The third optional element, which may
          also be empty, is a preprocessor identifier to be appended to the base
          name of the library required parameter if the particular mod header is
          being included and the Boost library has been chosen as the dual library.
        </p>
<p>
          If the first element mod identifier of the Boost PP tuple is not recognized,
          the entire tuple is ignored.
        </p>
<p>
          The optional parameters allow the macro invoker to specify his own identifiers
          to be appended to the base library name for each mod header being included.
          If he does not specify his own identifier for a particular mod by using
          an optional variadic parameter, defaults values are chosen instead.
        </p>
<p>
          The default values to be appended to the base name for each mod, depending
          on whether that mod uses the C++ standard library or the Boost library,
          are given in the following table:
        </p>
<div class="table">
<a name="cxxd.basic0.sec_lib.sec_lvvv.library_name"></a><p class="title"><b>Table&#160;1.7.&#160;Library name defaults</b></p>
<div class="table-contents"><table class="table" summary="Library name defaults">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                  <p>
                    Mod ID
                  </p>
                </th>
<th>
                  <p>
                    C++ standard
                  </p>
                </th>
</tr></thead>
<tbody>
<tr>
<td>
                  <p>
                    CXXD_ARRAY
                  </p>
                </td>
<td>
                  <p>
                    _ar
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_ATOMIC
                  </p>
                </td>
<td>
                  <p>
                    _at
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_BIND
                  </p>
                </td>
<td>
                  <p>
                    _bd
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_CHRONO
                  </p>
                </td>
<td>
                  <p>
                    _ch
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_CONDITION_VARIABLE
                  </p>
                </td>
<td>
                  <p>
                    _cv
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_ENABLE_SHARED_FROM_THIS
                  </p>
                </td>
<td>
                  <p>
                    _es
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_FUNCTION
                  </p>
                </td>
<td>
                  <p>
                    _fn
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_HASH
                  </p>
                </td>
<td>
                  <p>
                    _ha
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_MAKE_SHARED
                  </p>
                </td>
<td>
                  <p>
                    _ms
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_MEM_FN
                  </p>
                </td>
<td>
                  <p>
                    _mf
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_MOVE
                  </p>
                </td>
<td>
                  <p>
                    _mv
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_MUTEX
                  </p>
                </td>
<td>
                  <p>
                    _mx
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_RANDOM
                  </p>
                </td>
<td>
                  <p>
                    _rd
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_RATIO
                  </p>
                </td>
<td>
                  <p>
                    _ra
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_REF
                  </p>
                </td>
<td>
                  <p>
                    _rf
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_REGEX
                  </p>
                </td>
<td>
                  <p>
                    _rx
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_SHARED_MUTEX
                  </p>
                </td>
<td>
                  <p>
                    _sm
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_SHARED_PTR
                  </p>
                </td>
<td>
                  <p>
                    _sp
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_SYSTEM_ERROR
                  </p>
                </td>
<td>
                  <p>
                    _se
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_THREAD
                  </p>
                </td>
<td>
                  <p>
                    _th
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_TUPLE
                  </p>
                </td>
<td>
                  <p>
                    _tu
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_TYPE_INDEX
                  </p>
                </td>
<td>
                  <p>
                    _ti
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_TYPE_TRAITS
                  </p>
                </td>
<td>
                  <p>
                    _tt
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_UNORDERED_MAP
                  </p>
                </td>
<td>
                  <p>
                    _um
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_UNORDERED_MULTIMAP
                  </p>
                </td>
<td>
                  <p>
                    _up
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_UNORDERED_MULTISET
                  </p>
                </td>
<td>
                  <p>
                    _ut
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_UNORDERED_SET
                  </p>
                </td>
<td>
                  <p>
                    _us
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_WEAK_PTR
                  </p>
                </td>
<td>
                  <p>
                    _wp
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    CXXD_MODS_ALL
                  </p>
                </td>
<td>
                  <p>
                    _std
                  </p>
                </td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>
          As can be seen in the default table above:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
              Preprocessor identifiers are appended to the base name only when the
              C++ standard library has been chosen as the dual library for a particular
              mod. Nothing is appended to the base name when the Boost library has
              been chosen for a particular mod.
            </li>
<li class="listitem">
              The particular preprocessor identifiers added are two-character mnemonics
              preceded by an underscore. This was done to provide the smallest unique
              identifier while more clearly separating each mnemonic in the final
              name.
            </li>
</ul></div>
<p>
          The 'CXXD_MODS_ALL' identifier specifies a single mnemonic, in place of
          all the individual mnemonics, to be added to the base name if all the mod
          headers being included have either their C++ standard chosen as the dual
          library or their Boost library chosen as the dual library. In the default
          case above if all the mod headers being included have the C++ standard
          library as the dual library the final library variant name is the base
          name of the library with '_std' appended, while if all the mod headers
          being included have the Boost library as the dual library the final library
          variant name is just the base name with nothing further appended.
        </p>
<p>
          In the default case any appended mnemonics are added to the base name in
          the alphabetical order in which the individual mods occur in the default
          table above and not in the order in which the mods are included.
        </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
            The default appended mnemonics all begin with an underscore and lowercase
            letters so they should not clash with any macros of the same name. Nonetheless
            because there is a small chance of a macro clash if the compiler, or
            some other header file, defines macros with the same name as one of the
            default mnemonics, CXXD saves and restores possible macros definitions
            with the default appended mnemonics names. Saving is done automatically
            when the &lt;boost/cxx_dual/library_name.hpp&gt; is included. Restoring
            must be done manually by the end-user by including the header file &lt;boost/cxx_dual/library_name_post.hpp&gt;
            after the CXXD_LIBRARY_NAME macro is invoked. If you are sure that no
            other macro in the TU in which CXXD_LIBRARY_NAME is being used has the
            name of any one of the default appended mnemonics, you do not have to
            include &lt;boost/cxx_dual/library_name_post.hpp&gt; after the CXXD_LIBRARY_NAME
            is invoked. Defining macro names that are not all uppercase letters and/or
            that start with an underscore, such as the default appended mnemonics,
            is really bad macro design, but one never knows what compiler vendors
            or third-party libraries are capable of doing.
          </p></td></tr>
</table></div>
<p>
          The way that the CXXD_LIBRARY_NAME works, when the single required base
          name is passed to the macro, is exactly the manual method I have previously
          used when specifying unique variant names in the MyLibName.hpp samples
          given above. I chose to illustrate the manual method in the documentation
          based on the way that the CXXD_LIBRARY_NAME macro is designed to work when
          no optional parameters are specified and the default values are chosen.
          But of course an end-user, either manually specifying unique library variant
          names instead of using the CXXD_LIBRARY_NAME macro, or using the CXXD_LIBRARY_NAME
          macro and providing his own appended mnemonics as optional parameters,
          can create any schema he wants to name a library variant.
        </p>
<p>
          The default naming of CXXD_LIBRARY_NAME guarantees that if Boost is consistently
          being chosen as the dual library instead of the equivalent C++ standard
          library, which is what will naturally happen in the vast majority of cases
          if C++11 mode is not being used during compilation, the library name generated
          by CXXD_LIBRARY_NAME is the same as the base name. This latter is, I believe,
          what Boost library authors would expect in their non-header only libraries.
        </p>
<p>
          The end-user changes the default naming scheme by passing as optional parameters
          one or more Boost PP tuples for each mod where he wants a different mnemonic
          to be appended to the base name tahn what the default mnemonic table ofofers.
          In this case the Boost PP tuple specifies a different mnemonic to be used
          for a particular mod, depending on whether the dual library to be chosen
          for that mod is the C++ standard library or the Boost library. The order
          of the mnemonics to be appended also changes according to the order of
          the mod identifiers he specifies in the optional parameters, so that optional
          parameter mnemonics always precede default mnemonic choices in the final
          expanded name.
        </p>
<p>
          Before using the CXXD_LIBRARY_NAME macro the programmer should include
          the mod headers for the mods he wants the macro to analyze, in order to
          produce the desired library variant name. Just like when we manually created
          out MyLibName.hpp we really only need the low-level implementation headers
          for the mods we want the CXXD_LIBRARY_NAME macro to analyze. For this reason
          our examples below include the low-level implementation headers for the
          mods being used. Of course if the programmer is already including the mod
          headers themselves in a TU in which he is invoking the CXXD_LIBRARY_NAME
          macro there is absolutely no reason to separately include the low-level
          implementation headers.
        </p>
<p>
          A number of examples will be given of using the using CXXD_LIBRARY_NAME
          macro with the four mods we have previously chosen in our examples for
          MyLibName.hpp header file and some arbitrarily chosen combinations. These
          arbitrarily chosen combinations are specified purely to illustrate how
          the macro works:
        </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">array</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">function</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">regex</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">tuple</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">library_name</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="comment">/* If array uses Boost, function uses C++ standard, regex uses C++ standard, tuple uses Boost then: */</span>

<span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">)</span> <span class="identifier">expands</span> <span class="identifier">to</span> <span class="char">'MyLib_fn_rx'</span>

<span class="comment">/* If array uses C++ standard, function uses C++ standard, regex uses C++ standard, tuple uses C++ standard then: */</span>

<span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">)</span> <span class="identifier">expands</span> <span class="identifier">to</span> <span class="char">'MyLib_std'</span>

<span class="comment">/* If array uses Boost, function uses Boost, regex uses Boost, tuple uses Boost then: */</span>

<span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">)</span> <span class="identifier">expands</span> <span class="identifier">to</span> <span class="char">'MyLib'</span>

<span class="comment">/* If array uses Boost, function uses C++ standard, regex uses C++ standard, tuple uses Boost then: */</span>

<span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">,(</span><span class="identifier">CXXD_REGEX</span><span class="special">,</span><span class="identifier">RStd</span><span class="special">,</span><span class="identifier">_rboost</span><span class="special">))</span> <span class="identifier">expands</span> <span class="identifier">to</span> <span class="char">'MyLibRStd_fn'</span>

<span class="comment">/* If array uses Boost, function uses C++ standard, regex uses Boost, tuple uses Boost then: */</span>

<span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">,(</span><span class="identifier">CXXD_TUPLE</span><span class="special">,</span><span class="identifier">_cpp_tuple</span><span class="special">,</span><span class="identifier">_boost_tuple</span><span class="special">),(</span><span class="identifier">CXXD_ARRAY</span><span class="special">,,</span><span class="identifier">_bboost</span><span class="special">))</span> <span class="identifier">expands</span> <span class="identifier">to</span> <span class="char">'MyLib_boost_tuple_bboost_fn'</span>

<span class="comment">/* If array uses Boost, function uses Boost, regex uses Boost, tuple uses Boost then: */</span>

<span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">,(</span><span class="identifier">CXXD_ALL</span><span class="special">,</span><span class="identifier">Std</span><span class="special">,</span><span class="identifier">Boost</span><span class="special">))</span> <span class="identifier">expands</span> <span class="identifier">to</span> <span class="char">'MyLibBoost'</span>

<span class="comment">/* If array uses C++ standard, function uses C++ standard, regex uses C++ standard, tuple uses C++ standard then: */</span>

<span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">,(</span><span class="identifier">CXXD_ALL</span><span class="special">,</span><span class="identifier">Std</span><span class="special">,</span><span class="identifier">Boost</span><span class="special">))</span> <span class="identifier">expands</span> <span class="identifier">to</span> <span class="char">'MyLibStd'</span>
</pre>
<p>
          If we look at the MyLibName.hpp as presented previously we can use the
          CXXD_LIBRARY_NAME to simplify the syntax of the file. In the first case,
          where we do not try to limit the variants, our file would be:
        </p>
<pre class="programlisting"><span class="comment">// Header file MyLibName.hpp</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">array</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">function</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">regex</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">tuple</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">library_name</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#define</span> <span class="identifier">MYLIB_LIBRARY_NAME</span> <span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">)</span>
</pre>
<p>
          In the second case where we do limit the variants so that mod array and
          mod function always choose the same dual library, our file would be:
        </p>
<pre class="programlisting"><span class="comment">// Header file MyLibName.hpp</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">array</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">function</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">regex</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">tuple</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">library_name</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#if</span> <span class="special">(</span><span class="identifier">CXXD_HAS_STD_ARRAY</span> <span class="special">&amp;&amp;</span> <span class="special">!</span><span class="identifier">CXXD_HAS_STD_FUNCTION</span><span class="special">)</span> <span class="special">||</span> <span class="special">(!</span><span class="identifier">CXXD_HAS_STD_ARRAY</span> <span class="special">&amp;&amp;</span> <span class="identifier">CXXD_HAS_STD_FUNCTION</span><span class="special">)</span>
    <span class="preprocessor">#error</span> <span class="identifier">MyLib</span> <span class="special">-</span> <span class="identifier">CXXD</span> <span class="identifier">configuration</span> <span class="keyword">not</span> <span class="identifier">supported</span> <span class="identifier">where</span> <span class="identifier">array</span> <span class="keyword">and</span> <span class="identifier">function</span> <span class="identifier">differ</span><span class="special">.</span>
<span class="preprocessor">#else</span>
    <span class="preprocessor">#define</span> <span class="identifier">MYLIB_LIBRARY_NAME</span> <span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">)</span>
<span class="preprocessor">#endif</span>
</pre>
<p>
          In the third case where we limit our variants to the two choices of all
          Boost or all C++ standard libraries, our file would be:
        </p>
<pre class="programlisting"><span class="comment">// Header file MyLibName.hpp</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">array</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">function</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">regex</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">tuple</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">library_name</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#if</span> <span class="special">(</span><span class="identifier">CXXD_HAS_STD_ARRAY</span> <span class="special">&amp;&amp;</span> <span class="identifier">CXXD_HAS_STD_FUNCTION</span> <span class="special">&amp;&amp;</span> <span class="identifier">CXXD_HAS_STD_REGEX</span> <span class="special">&amp;&amp;</span> <span class="identifier">CXXD_HAS_STD_TUPLE</span><span class="special">)</span> <span class="special">||</span> <span class="special">\</span>
    <span class="special">!(</span><span class="identifier">CXXD_HAS_STD_ARRAY</span> <span class="special">||</span> <span class="identifier">CXXD_HAS_STD_FUNCTION</span> <span class="special">||</span> <span class="identifier">CXXD_HAS_STD_REGEX</span> <span class="special">||</span> <span class="identifier">CXXD_HAS_STD_TUPLE</span><span class="special">)</span>
    <span class="preprocessor">#define</span> <span class="identifier">MYLIB_LIBRARY_NAME</span> <span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">)</span>
<span class="preprocessor">#else</span>
    <span class="preprocessor">#error</span> <span class="identifier">CXXD</span> <span class="identifier">configuration</span> <span class="identifier">only</span> <span class="identifier">supported</span> <span class="keyword">if</span> <span class="identifier">all</span> <span class="identifier">dual</span> <span class="identifier">libraries</span> <span class="identifier">are</span> <span class="identifier">Boost</span> <span class="keyword">or</span> <span class="identifier">all</span> <span class="identifier">dual</span> <span class="identifier">libraries</span> <span class="identifier">are</span> <span class="identifier">C</span><span class="special">++</span> <span class="identifier">standard</span><span class="special">.</span>
<span class="preprocessor">#endif</span>
</pre>
<p>
          In all cases the invocation of the single CXXD_LIBRARY_NAME macro simplifies
          our MyLibName.hpp header file. Nonetheless the choice of using the CXXD_LIBRARY_NAME
          macro or manually name the library variants is totally up to the library
          author.
        </p>
<h6>
<a name="cxxd.basic0.sec_lib.sec_lvvv.h1"></a>
          <span class="phrase"><a name="cxxd.basic0.sec_lib.sec_lvvv.vvmac"></a></span><a class="link" href="sec_lvvv.html#cxxd.basic0.sec_lib.sec_lvvv.vvmac">Macro
          testing all possibilities</a>
        </h6>
<p>
          There is a macro in CXXD for testing whether the mod headers which are
          included, when the macro is actually invoked, match one or more combinations
          of dual library possibilities. This macro provides an automatic method
          for testing all dual library possibilities at once and offers an alternative
          to the manual testing of dual library possibilities which the end-user
          may have chosen to use. The macro is a variadic macro whose name and signature
          is:
        </p>
<pre class="programlisting"><span class="identifier">CXXD_VALID_VARIANTS</span><span class="special">(...)</span>
</pre>
<p>
          The macro is in the header file &lt;boost/cxx_dual/valid_variants.hpp&gt;
        </p>
<p>
          The variadic parameters are ways of encoding the various CXXD dual library
          combinations which the library author considers valid for his library.
          If the dual libraries chosen for the mods being included match any of combinations
          represented by the variadic parameters the macro expands to 1, otherwise
          it expands to 0.
        </p>
<p>
          Each variadic parameter represents a 'possibility'. Each possibility is
          a series of Boost PP tuples. This 'series' in the VMD library is called
          a VMD sequence.
        </p>
<p>
          Each Boost PP tuple in the series has two elements. The first Boost PP
          tuple element is a mod-ID or CXXD_MODS_ALL. The second Boost PP tuple element
          is either 0 or 1, meaning respectively that for the mod specified the dual
          library is Boost (0) or the dual library is the C++ standard library (1).
          If a mod-ID as the first tuple element is not recognized, or if the second
          tuple element is not 0 or 1, that tuple is ignored as part of a possibility
          but the possibility itself is still considered.
        </p>
<p>
          The Boost PP tuple encoding identifies a valid choice for the library being
          built for a single mod. The series of Boost PP tuples combine the valid
          choices into a single possibility. When a particular mod is not part of
          a possibility, as encoded by a mod-ID, it simply means that if that mod's
          header is included it can validly use either its Boost or C++ standard
          library as far as the possibility is concerned.
        </p>
<p>
          As an arbitrary example of a possibility:
        </p>
<pre class="programlisting"><span class="special">(</span><span class="identifier">CXXD_REGEX</span><span class="special">,</span><span class="number">0</span><span class="special">)(</span><span class="identifier">CXXD_ARRAY</span><span class="special">,</span><span class="number">1</span><span class="special">)(</span><span class="identifier">CXXD_TUPLE</span><span class="special">,</span><span class="number">1</span><span class="special">)</span>
</pre>
<p>
          as one of our variadic parameters says that a situation where the regex
          mod uses the Boost library while the array and tuple mods use the C++ standard
          library is a valid possibility for the library.
        </p>
<p>
          The library author can specify as many valid possibilities as he chooses
          as variadic parameters but at least one possibility has to be specified
          to use the macro. If all possible combinations of the mods being included
          are valid there is absolutely no point in using the CXXD_VALID_VARIANTS
          macro as we have no intention of limiting the possible variants by using
          the macro.
        </p>
<p>
          For the CXXD_MODS_ALL identifier only one tuple should define the possibility.
          The designation as a variadic parameter of:
        </p>
<pre class="programlisting"><span class="special">(</span><span class="identifier">CXXD_MODS_ALL</span><span class="special">,</span><span class="number">0</span><span class="special">)</span>
</pre>
<p>
          says that a valid possibility is that every mod included uses Boost as
          the dual library. The designation as a variadic parameter of:
        </p>
<pre class="programlisting"><span class="special">(</span><span class="identifier">CXXD_MODS_ALL</span><span class="special">,</span><span class="number">1</span><span class="special">)</span>
</pre>
<p>
          says that a valid possibility is that every mod included uses the C++ standard
          library as the dual library. If the CXXD_MODS_ALL tuple is combined with
          other tuples as part of a possibility the other tuples are ignored.
        </p>
<p>
          Before using the CXXD_VALID_VARIANTS macro the programmer should include
          the mod headers for the mods he wants the macro to analyze, in order to
          produce the desired result. Just like when we manually created out MyLibName.hpp
          we really only need the low-level implementation headers for the mods we
          want the CXXD_VALID_VARIANTS macro to analyze. For this reason our examples
          below include the low-level implementation headers for the mods being used.
          Of course if the programmer is already including the mod headers themselves
          in a TU in which he is invoking the CXXD_VALID_VARIANTS macro there is
          absolutely no reason to separately include the low-level implementation
          headers.
        </p>
<p>
          A number of examples will be given using the four mods we have previously
          chosen in our examples for MyLibName.hpp header file and some arbitrarily
          chosen valid possibilities. These arbitrarily chosen valid possibilities
          are specified purely to illustrate how the macro works:
        </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">array</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">function</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">regex</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">tuple</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">valid_variants</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="comment">/* Valid possibilities are:
1) All four mods use the Boost library
2) mod array uses the Boost library,
   mod function uses the C++ standard library,
   mod tuple uses the Boost library,
   mod regex uses either the Boost library or the C++ standard library
*/</span>

<span class="identifier">CXXD_VALID_VARIANTS</span><span class="special">((</span><span class="identifier">CXXD_MODS_ALL</span><span class="special">,</span><span class="number">0</span><span class="special">),(</span><span class="identifier">CXXD_ARRAY</span><span class="special">,</span><span class="number">0</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">1</span><span class="special">)(</span><span class="identifier">CXXD_TUPLE</span><span class="special">,</span><span class="number">0</span><span class="special">))</span>

<span class="comment">/* Valid possibilities are:
1) All four mods use the C++standard library
2) mod array uses the Boost library,
   mod function uses the Boost library
   mod tuple uses the Boost library or the C++ standard library,
   mod regex uses the Boost library or the C++ standard library
*/</span>

<span class="identifier">CXXD_VALID_VARIANTS</span><span class="special">((</span><span class="identifier">CXXD_MODS_ALL</span><span class="special">,</span><span class="number">1</span><span class="special">),(</span><span class="identifier">CXXD_ARRAY</span><span class="special">,</span><span class="number">0</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">0</span><span class="special">))</span>

<span class="comment">/* Valid possibilities are:
1) mod array uses the Boost library,
   mod function uses the Boost library
   mod tuple uses the Boost library or the C++ standard library,
   mod regex uses the Boost library or the C++ standard library
2) mod array uses the C++ standard library,
   mod function uses the C++ standard library
   mod tuple uses the Boost library or the C++ standard library,
   mod regex uses the Boost library or the C++ standard library
*/</span>

<span class="identifier">CXXD_VALID_VARIANTS</span><span class="special">((</span><span class="identifier">CXXD_ARRAY</span><span class="special">,</span><span class="number">0</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">0</span><span class="special">),(</span><span class="identifier">CXXD_ARRAY</span><span class="special">,</span><span class="number">1</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">1</span><span class="special">))</span>

<span class="comment">/* Valid possibilities are:
1) All four mods use the Boost library
2) All four mods use the C++standard library
3) mod regex uses the Boost library
   mod tuple uses the C++ standard library
   mod array uses the Boost library or the C++ standard library,
   mod function uses the Boost library or the C++ standard library
*/</span>

<span class="identifier">CXXD_VALID_VARIANTS</span><span class="special">((</span><span class="identifier">CXXD_MODS_ALL</span><span class="special">,</span><span class="number">0</span><span class="special">),(</span><span class="identifier">CXXD_MODS_ALL</span><span class="special">,</span><span class="number">1</span><span class="special">),(</span><span class="identifier">CXXD_REGEX</span><span class="special">,</span><span class="number">0</span><span class="special">)(</span><span class="identifier">CXXD_TUPLE</span><span class="special">,</span><span class="number">1</span><span class="special">))</span>
</pre>
<p>
          Essentially the CXXD_VALID_VARIANTS present an alternate form of '#if (CXXD_HAS_STD_XXX
          ...)' preprocessor constructs which are used to limit the mod possibilities
          which a particular library decides is valid. If we take our example MyLibName.hpp
          which limit the possibilities of dual libraries combinations we can re-code
          our second and third case using this macro. Since our first case, which
          does not limit the possibilities, has no use for using the CXXD_VALID_VARIANTS
          macro, we do not illustrate its use with the macro.
        </p>
<p>
          In the second case where we do limit the variants so that mod array and
          mod function always choose the same dual library, our file would now be:
        </p>
<pre class="programlisting"><span class="comment">// Header file MyLibName.hpp</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">array</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">function</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">regex</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">tuple</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">valid_variants</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#if</span> <span class="identifier">CXXD_VALID_VARIANTS</span><span class="special">((</span><span class="identifier">CXXD_ARRAY</span><span class="special">,</span><span class="number">0</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">0</span><span class="special">),(</span><span class="identifier">CXXD_ARRAY</span><span class="special">,</span><span class="number">1</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">1</span><span class="special">))</span>
    <span class="preprocessor">#define</span> <span class="identifier">MYLIB_LIBRARY_NAME</span> <span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">)</span>
<span class="preprocessor">#else</span>
    <span class="preprocessor">#error</span> <span class="identifier">MyLib</span> <span class="special">-</span> <span class="identifier">CXXD</span> <span class="identifier">configuration</span> <span class="keyword">not</span> <span class="identifier">supported</span> <span class="identifier">where</span> <span class="identifier">array</span> <span class="keyword">and</span> <span class="identifier">function</span> <span class="identifier">differ</span><span class="special">.</span>
<span class="preprocessor">#endif</span>
</pre>
<p>
          In the third case where we limit our variants to the two choices of all
          Boost or all C++ standard libraries, our file would now be:
        </p>
<pre class="programlisting"><span class="comment">// Header file MyLibName.hpp</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">array</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">function</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">regex</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">tuple</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">valid_variants</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#if</span> <span class="identifier">CXXD_VALID_VARIANTS</span><span class="special">((</span><span class="identifier">CXXD_MODS_ALL</span><span class="special">,</span><span class="number">0</span><span class="special">),(</span><span class="identifier">CXXD_MODS_ALL</span><span class="special">,</span><span class="number">1</span><span class="special">))</span>
    <span class="preprocessor">#define</span> <span class="identifier">MYLIB_LIBRARY_NAME</span> <span class="identifier">CXXD_LIBRARY_NAME</span><span class="special">(</span><span class="identifier">MyLib</span><span class="special">)</span>
<span class="preprocessor">#else</span>
    <span class="preprocessor">#error</span> <span class="identifier">CXXD</span> <span class="identifier">configuration</span> <span class="identifier">only</span> <span class="identifier">supported</span> <span class="keyword">if</span> <span class="identifier">all</span> <span class="identifier">dual</span> <span class="identifier">libraries</span> <span class="identifier">are</span> <span class="identifier">Boost</span> <span class="keyword">or</span> <span class="identifier">all</span> <span class="identifier">dual</span> <span class="identifier">libraries</span> <span class="identifier">are</span> <span class="identifier">C</span><span class="special">++</span> <span class="identifier">standard</span><span class="special">.</span>
<span class="preprocessor">#endif</span>
</pre>
<p>
          In both cases we produce shorter versions of our MyLibName.hpp code.
        </p>
<h6>
<a name="cxxd.basic0.sec_lib.sec_lvvv.h2"></a>
          <span class="phrase"><a name="cxxd.basic0.sec_lib.sec_lvvv.using_cxxd_valid_variants_for_a_"></a></span><a class="link" href="sec_lvvv.html#cxxd.basic0.sec_lib.sec_lvvv.using_cxxd_valid_variants_for_a_">Using
          CXXD_VALID_VARIANTS for a header-only library</a>
        </h6>
<p>
          Even though there is little practical benefit of limiting possibilities
          of mod dual library choices when the situation is a header only library
          as opposed to the non-header only library we have been discussing, the
          CXXD_VALID_VARIANTS macro could be used in that situation also. As an example
          let us suppose we have a header-only library which uses array mod and function
          mod along with other mods. As we have done in one of our non-header only
          MyLibName.hpp examples we arbitrarily decide that the array and function
          dual library choices should always match. We could code up a header file
          for the sole purpose of producing a preprocessor error if our array and
          function dual library choices do not match, and then include that header
          file in all are header-only library header files as a check to make sure
          they match whenever any of our header files is included. Our checking header
          file might be called MyHeaderOnlyLibCheck.hpp:
        </p>
<pre class="programlisting"><span class="comment">// Header file MyHeaderOnlyLibCheck.hpp</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">array</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">function</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">valid_variants</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#if</span> <span class="special">!</span><span class="identifier">CXXD_VALID_VARIANTS</span><span class="special">((</span><span class="identifier">CXXD_ARRAY</span><span class="special">,</span><span class="number">0</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">0</span><span class="special">),(</span><span class="identifier">CXXD_ARRAY</span><span class="special">,</span><span class="number">1</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">1</span><span class="special">))</span>
    <span class="preprocessor">#error</span> <span class="identifier">MyLib</span> <span class="special">-</span> <span class="identifier">CXXD</span> <span class="identifier">configuration</span> <span class="keyword">not</span> <span class="identifier">supported</span> <span class="identifier">where</span> <span class="identifier">array</span> <span class="keyword">and</span> <span class="identifier">function</span> <span class="identifier">differ</span><span class="special">.</span>
<span class="preprocessor">#endif</span>
</pre>
<p>
          We now include that header file in all of the header files of our header-only
          library and every time the end-user uses one of our header files a check
          is made to ensure that the dual libraries for array and function match.
        </p>
<p>
          Of course we could simply eschew the use of the CXXD_VALID_VARIANTS macro
          in this case and simply code up our MyHeaderOnlyLibCheck.hpp header file
          in this way:
        </p>
<pre class="programlisting"><span class="comment">// Header file MyHeaderOnlyLibCheck.hpp</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">array</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cxx_dual</span><span class="special">/</span><span class="identifier">impl</span><span class="special">/</span><span class="identifier">function</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#if</span> <span class="special">!((</span><span class="identifier">CXXD_HAS_STD_ARRAY</span> <span class="special">&amp;&amp;</span> <span class="identifier">CXXD_HAS_STD_FUNCTION</span><span class="special">)</span> <span class="special">||</span> <span class="special">(!</span><span class="identifier">CXXD_HAS_STD_ARRAY</span> <span class="special">&amp;&amp;</span> <span class="special">!</span><span class="identifier">CXXD_HAS_STD_FUNCTION</span><span class="special">))</span>
    <span class="preprocessor">#error</span> <span class="identifier">MyLib</span> <span class="special">-</span> <span class="identifier">CXXD</span> <span class="identifier">configuration</span> <span class="keyword">not</span> <span class="identifier">supported</span> <span class="identifier">where</span> <span class="identifier">array</span> <span class="keyword">and</span> <span class="identifier">function</span> <span class="identifier">differ</span><span class="special">.</span>
<span class="preprocessor">#endif</span>
</pre>
<p>
          Whether the possibility of using the CXXD_VALID_VARIANTS macro is considered
          for a non-header only library, its main purpose, or a header-only library,
          the choice of using the CXXD_VALID_VARIANTS macro or manually test the
          individual CXXD_HAS_STD_'XXX' macros is totally up to the library author.
        </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2015, 2016 Tropic Software East Inc<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../sec_lib.html"><img src="../../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../sec_lib.html"><img src="../../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="../../preprocessing_errors.html"><img src="../../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
