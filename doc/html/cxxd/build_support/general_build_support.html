<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>General build support</title>
<link rel="stylesheet" href="../../../../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../index.html" title="Chapter&#160;1.&#160;The Cxx Dual Library">
<link rel="up" href="../build_support.html" title="Build support">
<link rel="prev" href="../build_support.html" title="Build support">
<link rel="next" href="../header_files.html" title="Header files">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../boost.png"></td>
<td align="center"><a href="../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../build_support.html"><img src="../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../build_support.html"><img src="../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="../header_files.html"><img src="../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="cxxd.build_support.general_build_support"></a><a class="link" href="general_build_support.html" title="General build support">General build
      support</a>
</h3></div></div></div>
<p>
        There are two different means by which CXXD offers general build support
        to end-users.
      </p>
<h5>
<a name="cxxd.build_support.general_build_support.h0"></a>
        <span class="phrase"><a name="cxxd.build_support.general_build_support.running_a_program"></a></span><a class="link" href="general_build_support.html#cxxd.build_support.general_build_support.running_a_program">Running
        a program</a>
      </h5>
<p>
        For general build support there is a program in the CXXD build directory,
        which the end-user can build using Boost Build with a particular compiler,
        which when run will subsequently tell him whether or not particular mods
        use their Boost or C++ standard implementations. The program is called 'cxxd_choice'.
        The resulting program is specific to the compiler used when building the
        program and is self-contained, not relying on any shared libraries.
      </p>
<p>
        When cxxd_choice is invoked it takes as arguments one or more mod designations
        followed by a comma ( ',' ) and a 0 indicating a Boost implementation or
        a 1 indicating a C++ standard implementation. Examples for a single argument
        would be 'regex,0' to designate the Boost implementation for the regex mod
        implementation or 'tuple,1' to designate the C++ standard implementation
        for the tuple mod implementation. If the arguments all match the actual dual
        library implementations chosen the cxxd_choice program returns 0, otherwise
        it returns the number of arguments that did not match. This return value
        could then be subsequently used in general build systems to add whatever
        general build features are needed when a particular mod dual library choice,
        or a combination of choices, is made.
      </p>
<p>
        It needs to be emphasized that the results of the dual libraries chosen by
        default is completely reliant on the compiler invocation used when building
        the cxxd_choice program. Please recall that the default algorithm used by
        CXXD is that if the C++ standard library implementation of a mod is available
        during compilation that choice is made, otherwise the Boost library implementation
        for that mod is chosen. Not only will different compilers offer different
        default dual library choices in their compiler implementations but different
        compiler flags, such as ones designating the level of C++ support ( c++03,
        c++11, c++14 ), will change the dual library choices.
      </p>
<p>
        The cxxd_choice program can also write to standard output the results of
        its dual library choices. If the first command-line parameter is '-d' or
        '--debug', besides returning its 0 or non-zero value, the program will write
        to standard output the result of each dual library test made by the subsequent
        parameters. The results are in the exact form of:
      </p>
<pre class="programlisting"><span class="identifier">Processing</span> <span class="char">'argument'</span><span class="special">.</span>
<span class="identifier">Parameter</span> <span class="char">'argument'</span> <span class="identifier">succeeds</span><span class="special">.</span>
<span class="identifier">Parameter</span> <span class="char">'argument'</span> <span class="identifier">fails</span><span class="special">.</span>
<span class="identifier">Parameter</span> <span class="char">'argument'</span> <span class="identifier">has</span> <span class="identifier">an</span> <span class="identifier">invalid</span> <span class="identifier">format</span><span class="special">.</span>
</pre>
<p>
        each on its own line as applicable, where argument is the actual parameter
        subsequently passed as a command-line parameter to the program.
      </p>
<p>
        The cxxd_choice program, when passed no parameters, will return 0 but will
        also write to standard output the choice for every mod in the form of individual
        lines of:
      </p>
<pre class="programlisting"><span class="identifier">mod</span> <span class="identifier">name</span> <span class="special">=</span> <span class="number">0</span><span class="special">-</span><span class="keyword">or</span><span class="special">-</span><span class="number">1</span>
</pre>
<p>
        where mod name is the lowercase name of the mod, such as 'regex' or 'tuple',
        and 0 means the Boost library being chosen while 1 means the C++ standard
        library being chosen. The mod names are listed in alphabetical order.
      </p>
<p>
        By default when Boost Build builds the cxxd_choice program it will put its
        resulting exe in different directories depending on the compiler chosen when
        building the program. This means that each compiler will have its own copy
        of cxxd_choice, which is what the end-user wants, but the end-user needs
        to find the directory where Boost Build will put the exe.
      </p>
<p>
        The jamfile for building cxxd_choice in the CXXD 'build' subdirectory has
        a commented out line, which the end-user could uncomment, for specifying
        the exact location for putting the resulting exe. He could use Boost Build
        conditional requirements with the &lt;location&gt; property in the commented
        out line to specify where the exe should be installed for each compiler toolset
        he uses, as long as he gives the 'install' rule a different name for each
        compiler toolset being used. If he wanted to change the commented out install
        rule to manually specify different locations for different compilers his
        Boost Build code might look like:
      </p>
<pre class="programlisting"><span class="identifier">install</span> <span class="identifier">cxxd_choice_install_gcc</span> <span class="special">:</span> <span class="identifier">cxxd_choice</span> <span class="special">:</span> <span class="identifier">toolset</span><span class="special">=</span><span class="identifier">gcc</span><span class="special">:&lt;</span><span class="identifier">location</span><span class="special">&gt;</span><span class="identifier">gcc_path</span> <span class="special">;</span>
<span class="identifier">install</span> <span class="identifier">cxxd_choice_install_clang</span> <span class="special">:</span> <span class="identifier">cxxd_choice</span> <span class="special">:</span> <span class="identifier">toolset</span><span class="special">=</span><span class="identifier">clang</span><span class="special">:&lt;</span><span class="identifier">location</span><span class="special">&gt;</span><span class="identifier">clang_path</span> <span class="special">;</span>
<span class="identifier">install</span> <span class="identifier">cxxd_choice_install_msvc</span> <span class="special">:</span> <span class="identifier">cxxd_choice</span> <span class="special">:</span> <span class="identifier">toolset</span><span class="special">=</span><span class="identifier">msvc</span><span class="special">:&lt;</span><span class="identifier">location</span><span class="special">&gt;</span><span class="identifier">msvc_path</span> <span class="special">;</span>
</pre>
<p>
        The names for the install rule are purely arbitrary, but need to be different
        for each toolset chosen.
      </p>
<h5>
<a name="cxxd.build_support.general_build_support.h1"></a>
        <span class="phrase"><a name="cxxd.build_support.general_build_support.testing_variants"></a></span><a class="link" href="general_build_support.html#cxxd.build_support.general_build_support.testing_variants">Testing
        variants</a>
      </h5>
<p>
        For on-the-fly testing of dual library choices there is a source file in
        the 'test' directory called 'test_vv.cpp'. This test is represented by a
        Boost Build explicit alias called 'tvv'. This means that the test is only
        run when you explicitly pass the mnemonic 'tvv' to the command line when
        running tests for the CXXD library.
      </p>
<p>
        The 'test_vv.cpp' test is just a compile of a program that either succeeds
        as a compile or fails. In order to succeed compilation the invoker of the
        test must pass on the command line a macro definition for a macro called
        'CXXD_VV' which is equal to a single <a class="link" href="../sadvanced/sec_lib/sec_lvvv.html#cxxd.sadvanced.sec_lib.sec_lvvv.vvmac">valid
        variant</a> macro parameter. A valid variant macro parameter, which has
        previously been explained, is a way of encoding what dual library possibility
        is wanted. It takes the form of a VMD sequence of two element tuples where
        the first element is the mod-ID and the second element is 0 for the Boost
        implementation or 1 for the C++ standard library implementation.
      </p>
<p>
        To test the compilation of test_vv.cpp the b2 command line, run in rhe CXXD
        test directory, would look like:
      </p>
<pre class="programlisting"><span class="identifier">b2</span> <span class="identifier">toolset</span><span class="special">=</span><span class="identifier">some_compiler</span> <span class="identifier">tvv</span> <span class="identifier">define</span><span class="special">=</span><span class="identifier">CXXD_VV</span><span class="special">=</span><span class="identifier">some_vmd_sequence</span>
</pre>
<p>
        A typical VMD sequence might look like:
      </p>
<pre class="programlisting"><span class="special">(</span><span class="identifier">CXXD_REGEX</span><span class="special">,</span><span class="number">0</span><span class="special">)</span>
</pre>
<p>
        or
      </p>
<pre class="programlisting"><span class="special">(</span><span class="identifier">CXXD_BIND</span><span class="special">,</span><span class="number">1</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">1</span><span class="special">)(</span><span class="identifier">CXXD_REF</span><span class="special">,</span><span class="number">1</span><span class="special">)</span>
</pre>
<p>
        so the command line might be something like:
      </p>
<pre class="programlisting"><span class="identifier">b2</span> <span class="identifier">toolset</span><span class="special">=</span><span class="identifier">gcc</span> <span class="identifier">tvv</span> <span class="identifier">define</span><span class="special">=</span><span class="identifier">CXXD_VV</span><span class="special">=(</span><span class="identifier">CXXD_REGEX</span><span class="special">,</span><span class="number">0</span><span class="special">)</span>
</pre>
<p>
        or
      </p>
<pre class="programlisting"><span class="identifier">b2</span> <span class="identifier">toolset</span><span class="special">=</span><span class="identifier">clang</span> <span class="identifier">tvv</span> <span class="identifier">define</span><span class="special">=</span><span class="identifier">CXXD_VV</span><span class="special">=(</span><span class="identifier">CXXD_BIND</span><span class="special">,</span><span class="number">1</span><span class="special">)(</span><span class="identifier">CXXD_FUNCTION</span><span class="special">,</span><span class="number">1</span><span class="special">)(</span><span class="identifier">CXXD_REF</span><span class="special">,</span><span class="number">1</span><span class="special">)</span>
</pre>
<p>
        If the VMD sequence matches at compile time what the compiler provides in
        the way of the default dual library choice for the mods in the sequence the
        compilation succeeds, otherwise the compilation fails.
      </p>
<p>
        This on-the-fly invocation of a CXXD test to match dual library choices could
        be used by build tools which can specify different features based on whether
        a program execution fails or not. It can also be used by an end-user to determine
        on-the-fly whether or not particular mods match in their dual library choices
        some desired configuration.
      </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2015, 2016 Tropic Software East Inc<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../build_support.html"><img src="../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../build_support.html"><img src="../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="../header_files.html"><img src="../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
